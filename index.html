<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Boolean Rule Evaluator</title>
  <style>
    body { font-family: system-ui, sans-serif; padding: 20px; background: #fafafa; }
    input { width: 300px; padding: 6px; font-size: 1rem; }
    button { margin-left: 8px; padding: 6px 12px; font-size: 1rem; cursor: pointer; border-radius: 6px; border: 1px solid #ccc; background: #fff; }
    button:hover { background: #f0f0f0; }
    #result { margin-top: 20px; font-weight: bold; }
    #copyMsg { margin-top: 10px; color: green; font-size: 0.9rem; display: none; }
  </style>
</head>
<body>

  <h3>Enter numbers (comma separated):</h3>
  <input id="inputValues" type="text" placeholder="e.g. 1,2,13,5">
  <button onclick="evaluateInput()">Evaluate</button>
  <button onclick="saveLink()">Save</button>

  <div id="result"></div>
  <div id="copyMsg">✅ Link copied to clipboard!</div>

  <script>
    const rules = [
      { condition: "1 OR 2 AND NOT 3 AND 13 AND 5", output: "010" },
      { condition: "13", output: "011" },
      { condition: "13 OR 5", output: "201" }
    ];

    function evaluateInput() {
      const inputText = document.getElementById("inputValues").value;
      const inputs = new Set(inputText.split(",").map(x => x.trim()).filter(x => x !== ""));
      const outputs = [];

      for (const rule of rules) {
        if (evaluateCondition(rule.condition, inputs)) {
          outputs.push(rule.output);
        }
      }

      document.getElementById("result").textContent =
        outputs.length ? outputs.join(", ") : "No match";
    }

    function evaluateCondition(expr, inputs) {
      let jsExpr = expr
        .replace(/\bAND\b/g, "&&")
        .replace(/\bOR\b/g, "||")
        .replace(/\bNOT\b/g, "!")
        .replace(/\b(\d+)\b/g, (_, n) => `inputs.has("${n}")`);
      try {
        return Function("inputs", `return ${jsExpr}`)(inputs);
      } catch (e) {
        console.error("Error evaluating:", expr, e);
        return false;
      }
    }

    // Prefill and auto-evaluate from URL
    window.addEventListener("DOMContentLoaded", () => {
      const params = new URLSearchParams(window.location.search);
      const inputParam = params.get("in");
      if (inputParam) {
        document.getElementById("inputValues").value = inputParam;
        evaluateInput();
      }
    });

    // Save button logic – generate shareable link
    function saveLink() {
      const inputText = document.getElementById("inputValues").value.trim();
      if (!inputText) return;

      const url = new URL(window.location.href);
      url.searchParams.set("in", inputText);

      // Copy URL to clipboard
      navigator.clipboard.writeText(url.toString())
        .then(() => {
          const msg = document.getElementById("copyMsg");
          msg.style.display = "block";
          setTimeout(() => msg.style.display = "none", 2000);
        })
        .catch(err => console.error("Clipboard copy failed:", err));
    }
  </script>

</body>
</html>
