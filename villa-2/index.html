<!doctype html>
<html lang="hr">
<head>
<meta charset="utf-8">
<title>Murder Mystery Evaluator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg1:#171414;
  --bg2:#2a1c1c;
  --card:#2f2424;
  --accent:#c84b4b;
  --gold:#d4b46e;
  --muted:#b7a9a9;
  --panel:#3b2b2b;
}
html,body{
  height:100%;
  margin:0;
  font-family:"Segoe UI",system-ui,sans-serif;
  background:radial-gradient(circle at 10% 10%,var(--bg2),var(--bg1));
}
.wrap{max-width:1100px;margin:28px auto;padding:20px}
.card{
  background:var(--card);
  padding:20px;
  border-radius:12px;
  color:var(--muted);
  box-shadow:0 10px 40px rgba(0,0,0,0.6);
}
h1{color:var(--gold)}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(170px,1fr));gap:12px}
.player-container{
  background:#fff;
  border-radius:16px;
  padding:14px;
  text-align:center;
}
.player-emoji{font-size:40px}
.player-label{font-weight:bold;display:block;margin-bottom:6px}
input,textarea{
  width:100%;
  padding:8px;
  border-radius:8px;
  border:none;
  box-sizing:border-box;
}
textarea{min-height:120px;background:var(--panel);color:#fff}
button{
  background:var(--accent);
  border:none;
  color:#fff;
  padding:8px 12px;
  border-radius:8px;
  cursor:pointer;
  font-weight:bold;
}
.controls{margin-top:10px;display:flex;gap:8px;flex-wrap:wrap}
.result-player{
  margin-top:15px;
  border-radius:14px;
  padding:15px;
  color:#000;
}
.result-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:10px;
}
.result-cards div{
  margin-bottom:6px;
}
pre{
  background:#0d0b0b;
  color:#ddd;
  padding:10px;
  border-radius:8px;
  max-height:300px;
  overflow:auto;
}
</style>
</head>
<body>
<div class="wrap">
<div class="card">

<h1>ğŸ© Murder Mystery Evaluator</h1>

<div class="grid">
<div class="player-container"><div class="player-emoji">ğŸğŸŸ¢</div><label id="label1" class="player-label">Player1</label><input id="p1"></div>
<div class="player-container"><div class="player-emoji">ğŸ¦€ğŸ”´</div><label id="label2" class="player-label">Player2</label><input id="p2"></div>
<div class="player-container"><div class="player-emoji">ğŸˆâ€â¬›âš«</div><label id="label3" class="player-label">Player3</label><input id="p3"></div>
<div class="player-container"><div class="player-emoji">ğŸ‹ğŸ”µ</div><label id="label4" class="player-label">Player4</label><input id="p4"></div>
<div class="player-container"><div class="player-emoji">ğŸ¥ğŸŸ¡</div><label id="label5" class="player-label">Player5</label><input id="p5"></div>
<div class="player-container"><div class="player-emoji">ğŸ‘âšª</div><label id="label6" class="player-label">Player6</label><input id="p6"></div>
<div class="player-container"><div class="player-emoji">ğŸ«ğŸŸ </div><label id="label7" class="player-label">Player7</label><input id="p7"></div>
<div class="player-container"><div class="player-emoji">ğŸ†ğŸŸ£</div><label id="label8" class="player-label">Player8</label><input id="p8"></div>
<div class="player-container"><div class="player-emoji">ğŸ·ğŸ©·</div><label id="label9" class="player-label">Player9</label><input id="p9"></div>
</div>

<div style="margin-top:10px">
<label style="color:var(--gold)">Globalni brojevi</label>
<input id="globalNumbers">
</div>

<div class="controls">
<button id="evalBtn">âš–ï¸ Evaluiraj</button>
</div>

<h3 style="color:var(--gold)">Rezultati</h3>
<div id="result"></div>

<h3 style="color:var(--gold)">Pravila JSON</h3>
<textarea id="rules">[
{"header":"true","p1":"Petar","color":"#808080"},
{"header":"true","p2":"Igor","color":"#FFFF00"},
{"header":"true","key":"300","value":"U kuhinji nalaziÅ¡ noÅ¾."},
{"cond":"150","out":"300"}
]</textarea>

<h4 style="color:var(--gold)">Debug</h4>
<pre id="debug">â€”</pre>

</div>
</div>

<script>
function getPlayers(){
  const arr=[];
  for(let i=1;i<=9;i++){
    const v=document.getElementById("p"+i).value.trim();
    arr.push(v? v : null);
  }
  return arr;
}
function parseList(s){
  if(!s)return[];
  return s.split(',').map(x=>x.trim()).filter(x=>x);
}
function buildNumberMap(players,globals){
  const map={};
  players.forEach((v,i)=>{
    if(!v)return;
    v.split(',').forEach(n=>{
      n=n.trim();
      if(!map[n])map[n]=new Set();
      map[n].add(i);
    });
  });
  globals.forEach(g=>{
    if(!map[g])map[g]=new Set();
    players.forEach((v,i)=>{if(v)map[g].add(i);});
  });
  const out={};
  Object.keys(map).forEach(k=>out[k]=Array.from(map[k]));
  return out;
}
function setPlayerName(i,name){
  document.getElementById("label"+i).innerText=name;
}
function setPlayerColor(i,color){
  document.getElementsByClassName("player-container")[i-1].style.background=color;
}
function copyText(t){
  navigator.clipboard.writeText(t);
  alert("Copied!");
}
document.getElementById("evalBtn").addEventListener("click",()=>{
  const players=getPlayers();
  const globals=parseList(document.getElementById("globalNumbers").value);
  const numberMap=buildNumberMap(players,globals);
  let rules;
  try{rules=JSON.parse(document.getElementById("rules").value);}
  catch(e){alert("JSON error");return;}

  const cardMap={};
  const realRules=[];
  rules.forEach(r=>{
    if(r.header==="true"){
      for(let k in r){
        if(k.startsWith("p")){
          const idx=parseInt(k.slice(1));
          setPlayerName(idx,r[k]);
          if(r.color)setPlayerColor(idx,r.color);
        }
      }
      if(r.key&&r.value)cardMap[r.key]=r.value;
    }else if(r.cond)realRules.push(r);
  });

  const playerCards={};
  players.forEach((v,i)=>{
    if(v!==null)playerCards["Player"+(i+1)]=[];
  });

  realRules.forEach(r=>{
    const cond=r.cond;
    const out=r.out;
    const assigned=[];
    Object.keys(numberMap).forEach(n=>{
      if(cond.includes(n)){
        numberMap[n].forEach(i=>assigned.push("Player"+(i+1)));
      }
    });
    const unique=[...new Set(assigned)];
    if(unique.length>0){
      unique.forEach(p=>{
        playerCards[p].push(cardMap[out]||out);
      });
    }
  });

  let html="";
  Object.keys(playerCards).forEach(p=>{
    if(playerCards[p].length===0)return;
    const text=playerCards[p].join("\n\n");
    html+=`
    <div class="result-player" style="background:#ffffff">
      <div class="result-header">
        <strong>${document.getElementById("label"+p.replace("Player","")).innerText}</strong>
        <button onclick="copyText(\`${text}\`)">Copy</button>
      </div>
      <div class="result-cards">
        ${playerCards[p].map(c=>`<div>${c}</div>`).join("")}
      </div>
    </div>`;
  });

  document.getElementById("result").innerHTML=html||"Nema rezultata.";
  document.getElementById("debug").innerText=JSON.stringify(numberMap,null,2);
});
</script>
</body>
</html>
